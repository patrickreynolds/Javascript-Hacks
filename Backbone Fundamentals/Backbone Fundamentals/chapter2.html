<!DOCTYPE html>
<html>
	<head>
		<title>Chapter 2</title>
		<script type="text/javascript" src="../global/lib/jquery.min.js"></script>
		<script type="text/javascript" src="../global/lib/underscore-min.js"></script>
		<script type="text/javascript" src="../global/lib/backbone-min.js"></script>
		<script type="text/javascript" src="../global/lib/backbone.localStorage.js"></script>
		<script type="text/javascript" src="../global/lib/backbone.marionette.js"></script>
		<script type="text/javascript" src="../global/lib/bootstrap-3.1.1/js/bootstrap.min.js"></script>
		<link   type="text/css" rel="stylesheet" href="../global/lib/bootstrap-3.1.1/css/bootstrap.min.css">
	</head>
	<body>
		<section id='container'>
		</section>

		<script type="text/javascript">

			// ---- Model Declarations ----
			var User = Backbone.Model.extend({});


			// ---- Collection Declarations ----
			var Users = Backbone.Collection.extend({
			  model: User
			});

			var users = new Users([{
			  id: 1,
			  name: 'John Doe'
			}, {
			  id: 2,
			  name: 'Dan Smith'
			}]);


			// ---- View Declarations ----
			var ParentView = Backbone.View.extend({
			  	initialize: function () {
			    	this.subViews = []; 
			   
			   	// Initializing the child views
			    	this.subViews.push(new ChildView(), new ChildView());
			  	},

			  	render: function () {
			    	this.$el.html(this.template);

			  			// Render each child view
			    		_(this.subViews).each(function (view) {
			      		this.$el.append(view.render().el);
			    	}, this);

			    	return this;
			  	}
			});


			var UserItemView = Backbone.View.extend({
			  tagName: 'li',
			  template: _.template( '<%= name %>'),
			  events: {
			    'click': 'showUserName',
			    'dblclick': 'alertUserName'
			  },
			  render: function () {
			    var html = this.template(this.model.toJSON());
			    this.$el.html(html);
			    return this;
			  },

			  showUserName: function () {
			    console.log('Clicked user\'s name: ' + this.model.get('name'));
			  },

			  alertUserName: function() {
			  	alert('Clicked user\'s name: ' + this.model.get('name'));
			  }
			});

			var UsersView = Backbone.View.extend({
				tagName: 'ul',

				render: function () {
					// create a document fragment
					var fragment = document.createDocumentFragment();

					this.collection.each(function (model) {
						// add each view element to the document fragment
						fragment.appendChild(new UserItemView({
							model: model
						}).render().el);
					}, this);

					// append the fragment to the DOM
					this.$el.html(fragment);
					return this;
				},

				events: {
					//'click li': 'alertUserName',
				},
			});

			var usersView = new UsersView({
				// add the collection instance
				collection: users
			});

			$(document.body).append(usersView.render().el);

		</script>
	</body>
</html>


